%% -*-emacs-lisp-*-
%%
%% inputenc package for Hyperlatex
%% version 0.6 (8 March 2003)
%%
%% Allow the user to specify an input encoding by:
%%   \usepackage[<encoding name>]{inputenc}
%%
%% Copyright (C) 2002, 2003 Ulrich Mueller <ulm@kph.uni-mainz.de>
%%
%% This program is free software; you can redistribute it and/or modify
%% it under the terms of the GNU General Public License as published
%% by the Free Software Foundation; either version 2 of the License,
%% or (at your option) any later version.
%%
%% This program is distributed in the hope that it will be useful,
%% but WITHOUT ANY WARRANTY; without even the implied warranty of
%% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
%% GNU General Public License for more details.
%%
%% A copy of the GNU General Public License is available on the
%% World Wide Web at <http://www.gnu.org/licenses/gpl.html>. You can
%% also obtain it by writing to the Free Software Foundation, Inc.,
%% 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
%%

\HlxEval{
(require 'advice)

(defvar hyperlatex-inputenc-output-encoding nil
  "*Control output of non-ASCII characters.
If nil, output mnemonic entities per default. If `\\htmlcharset'
has been set to `iso-8859-1' or `utf-8' (case-insensitive),
output characters in this encoding.
If `mnemonic', always output mnemonic entities.
If `numeric', output numeric entities.
If `iso-8859-1', output ISO-8859-1 characters.
If `utf-8', output UTF-8 characters.")

(defvar hyperlatex-inputenc-encoding-iso-8859-1
  (let ((l nil) (i 256))
    (while (>= (setq i (1- i)) 160)
      (setq l (cons (list i i) l)))
    l))
(defvar hyperlatex-inputenc-encoding-iso-8859-2
  '((160 160) (161 260) (162 728) (163 321) (164 164) (165 317) (166 346)
    (167 167) (168 168) (169 352) (170 350) (171 356) (172 377) (173 173)
    (174 381) (175 379) (176 176) (177 261) (178 731) (179 322) (180 180)
    (181 318) (182 347) (183 711) (184 184) (185 353) (186 351) (187 357)
    (188 378) (189 733) (190 382) (191 380) (192 340) (193 193) (194 194)
    (195 258) (196 196) (197 313) (198 262) (199 199) (200 268) (201 201)
    (202 280) (203 203) (204 282) (205 205) (206 206) (207 270) (208 272)
    (209 323) (210 327) (211 211) (212 212) (213 336) (214 214) (215 215)
    (216 344) (217 366) (218 218) (219 368) (220 220) (221 221) (222 354)
    (223 223) (224 341) (225 225) (226 226) (227 259) (228 228) (229 314)
    (230 263) (231 231) (232 269) (233 233) (234 281) (235 235) (236 283)
    (237 237) (238 238) (239 271) (240 273) (241 324) (242 328) (243 243)
    (244 244) (245 337) (246 246) (247 247) (248 345) (249 367) (250 250)
    (251 369) (252 252) (253 253) (254 355) (255 729)))
(defvar hyperlatex-inputenc-encoding-iso-8859-3
  '((160 160) (161 294) (162 728) (163 163) (164 164) (166 292) (167 167)
    (168 168) (169 304) (170 350) (171 286) (172 308) (173 173) (175 379)
    (176 176) (177 295) (178 178) (179 179) (180 180) (181 181) (182 293)
    (183 183) (184 184) (185 305) (186 351) (187 287) (188 309) (189 189)
    (191 380) (192 192) (193 193) (194 194) (196 196) (197 266) (198 264)
    (199 199) (200 200) (201 201) (202 202) (203 203) (204 204) (205 205)
    (206 206) (207 207) (209 209) (210 210) (211 211) (212 212) (213 288)
    (214 214) (215 215) (216 284) (217 217) (218 218) (219 219) (220 220)
    (221 364) (222 348) (223 223) (224 224) (225 225) (226 226) (228 228)
    (229 267) (230 265) (231 231) (232 232) (233 233) (234 234) (235 235)
    (236 236) (237 237) (238 238) (239 239) (241 241) (242 242) (243 243)
    (244 244) (245 289) (246 246) (247 247) (248 285) (249 249) (250 250)
    (251 251) (252 252) (253 365) (254 349) (255 729)))
(defvar hyperlatex-inputenc-encoding-iso-8859-4
  '((160 160) (161 260) (162 312) (163 342) (164 164) (165 296) (166 315)
    (167 167) (168 168) (169 352) (170 274) (171 290) (172 358) (173 173)
    (174 381) (175 175) (176 176) (177 261) (178 731) (179 343) (180 180)
    (181 297) (182 316) (183 711) (184 184) (185 353) (186 275) (187 291)
    (188 359) (189 330) (190 382) (191 331) (192 256) (193 193) (194 194)
    (195 195) (196 196) (197 197) (198 198) (199 302) (200 268) (201 201)
    (202 280) (203 203) (204 278) (205 205) (206 206) (207 298) (208 272)
    (209 325) (210 332) (211 310) (212 212) (213 213) (214 214) (215 215)
    (216 216) (217 370) (218 218) (219 219) (220 220) (221 360) (222 362)
    (223 223) (224 257) (225 225) (226 226) (227 227) (228 228) (229 229)
    (230 230) (231 303) (232 269) (233 233) (234 281) (235 235) (236 279)
    (237 237) (238 238) (239 299) (240 273) (241 326) (242 333) (243 311)
    (244 244) (245 245) (246 246) (247 247) (248 248) (249 371) (250 250)
    (251 251) (252 252) (253 361) (254 363) (255 729)))
(defvar hyperlatex-inputenc-encoding-iso-8859-9
  '((160 160) (161 161) (162 162) (163 163) (164 164) (165 165) (166 166)
    (167 167) (168 168) (169 169) (170 170) (171 171) (172 172) (173 173)
    (174 174) (175 175) (176 176) (177 177) (178 178) (179 179) (180 180)
    (181 181) (182 182) (183 183) (184 184) (185 185) (186 186) (187 187)
    (188 188) (189 189) (190 190) (191 191) (192 192) (193 193) (194 194)
    (195 195) (196 196) (197 197) (198 198) (199 199) (200 200) (201 201)
    (202 202) (203 203) (204 204) (205 205) (206 206) (207 207) (208 286)
    (209 209) (210 210) (211 211) (212 212) (213 213) (214 214) (215 215)
    (216 216) (217 217) (218 218) (219 219) (220 220) (221 304) (222 350)
    (223 223) (224 224) (225 225) (226 226) (227 227) (228 228) (229 229)
    (230 230) (231 231) (232 232) (233 233) (234 234) (235 235) (236 236)
    (237 237) (238 238) (239 239) (240 287) (241 241) (242 242) (243 243)
    (244 244) (245 245) (246 246) (247 247) (248 248) (249 249) (250 250)
    (251 251) (252 252) (253 305) (254 351) (255 255)))
(defvar hyperlatex-inputenc-encoding-iso-8859-10
  '((160 160) (161 260) (162 274) (163 290) (164 298) (165 296) (166 310)
    (167 167) (168 315) (169 272) (170 352) (171 358) (172 381) (173 173)
    (174 362) (175 330) (176 176) (177 261) (178 275) (179 291) (180 299)
    (181 297) (182 311) (183 183) (184 316) (185 273) (186 353) (187 359)
    (188 382) (189 8213) (190 363) (191 331) (192 256) (193 193) (194 194)
    (195 195) (196 196) (197 197) (198 198) (199 302) (200 268) (201 201)
    (202 280) (203 203) (204 278) (205 205) (206 206) (207 207) (208 208)
    (209 325) (210 332) (211 211) (212 212) (213 213) (214 214) (215 360)
    (216 216) (217 370) (218 218) (219 219) (220 220) (221 221) (222 222)
    (223 223) (224 257) (225 225) (226 226) (227 227) (228 228) (229 229)
    (230 230) (231 303) (232 269) (233 233) (234 281) (235 235) (236 279)
    (237 237) (238 238) (239 239) (240 240) (241 326) (242 333) (243 243)
    (244 244) (245 245) (246 246) (247 361) (248 248) (249 371) (250 250)
    (251 251) (252 252) (253 253) (254 254) (255 312)))
(defvar hyperlatex-inputenc-encoding-iso-8859-13
  '((160 160) (161 8221) (162 162) (163 163) (164 164) (165 8222)
    (166 166) (167 167) (168 216) (169 169) (170 342) (171 171) (172 172)
    (173 173) (174 174) (175 198) (176 176) (177 177) (178 178) (179 179)
    (180 8220) (181 181) (182 182) (183 183) (184 248) (185 185) (186 343)
    (187 187) (188 188) (189 189) (190 190) (191 230) (192 260) (193 302)
    (194 256) (195 262) (196 196) (197 197) (198 280) (199 274) (200 268)
    (201 201) (202 377) (203 278) (204 290) (205 310) (206 298) (207 315)
    (208 352) (209 323) (210 325) (211 211) (212 332) (213 213) (214 214)
    (215 215) (216 370) (217 321) (218 346) (219 362) (220 220) (221 379)
    (222 381) (223 223) (224 261) (225 303) (226 257) (227 263) (228 228)
    (229 229) (230 281) (231 275) (232 269) (233 233) (234 378) (235 279)
    (236 291) (237 311) (238 299) (239 316) (240 353) (241 324) (242 326)
    (243 243) (244 333) (245 245) (246 246) (247 247) (248 371) (249 322)
    (250 347) (251 363) (252 252) (253 380) (254 382) (255 8217)))
(defvar hyperlatex-inputenc-encoding-iso-8859-14
  '((160 160) (161 7682) (162 7683) (163 163) (164 266) (165 267)
    (166 7690) (167 167) (168 7808) (169 169) (170 7810) (171 7691)
    (172 7922) (173 173) (174 174) (175 376) (176 7710) (177 7711)
    (178 288) (179 289) (180 7744) (181 7745) (182 182) (183 7766)
    (184 7809) (185 7767) (186 7811) (187 7776) (188 7923) (189 7812)
    (190 7813) (191 7777) (192 192) (193 193) (194 194) (195 195)
    (196 196) (197 197) (198 198) (199 199) (200 200) (201 201) (202 202)
    (203 203) (204 204) (205 205) (206 206) (207 207) (208 372) (209 209)
    (210 210) (211 211) (212 212) (213 213) (214 214) (215 7786) (216 216)
    (217 217) (218 218) (219 219) (220 220) (221 221) (222 374) (223 223)
    (224 224) (225 225) (226 226) (227 227) (228 228) (229 229) (230 230)
    (231 231) (232 232) (233 233) (234 234) (235 235) (236 236) (237 237)
    (238 238) (239 239) (240 373) (241 241) (242 242) (243 243) (244 244)
    (245 245) (246 246) (247 7787) (248 248) (249 249) (250 250) (251 251)
    (252 252) (253 253) (254 375) (255 255)))
(defvar hyperlatex-inputenc-encoding-iso-8859-15
  '((160 160) (161 161) (162 162) (163 163) (164 8364) (165 165) (166 352)
    (167 167) (168 353) (169 169) (170 170) (171 171) (172 172) (173 173)
    (174 174) (175 175) (176 176) (177 177) (178 178) (179 179) (180 381)
    (181 181) (182 182) (183 183) (184 382) (185 185) (186 186) (187 187)
    (188 338) (189 339) (190 376) (191 191) (192 192) (193 193) (194 194)
    (195 195) (196 196) (197 197) (198 198) (199 199) (200 200) (201 201)
    (202 202) (203 203) (204 204) (205 205) (206 206) (207 207) (208 208)
    (209 209) (210 210) (211 211) (212 212) (213 213) (214 214) (215 215)
    (216 216) (217 217) (218 218) (219 219) (220 220) (221 221) (222 222)
    (223 223) (224 224) (225 225) (226 226) (227 227) (228 228) (229 229)
    (230 230) (231 231) (232 232) (233 233) (234 234) (235 235) (236 236)
    (237 237) (238 238) (239 239) (240 240) (241 241) (242 242) (243 243)
    (244 244) (245 245) (246 246) (247 247) (248 248) (249 249) (250 250)
    (251 251) (252 252) (253 253) (254 254) (255 255)))
(defvar hyperlatex-inputenc-encoding-iso-8859-16
  '((160 160) (161 260) (162 261) (163 321) (164 8364) (165 8222)
    (166 352) (167 167) (168 353) (169 169) (170 536) (171 171) (172 377)
    (173 173) (174 378) (175 379) (176 176) (177 177) (178 268) (179 322)
    (180 381) (181 8221) (182 182) (183 183) (184 382) (185 269) (186 537)
    (187 187) (188 338) (189 339) (190 376) (191 380) (192 192) (193 193)
    (194 194) (195 258) (196 196) (197 262) (198 198) (199 199) (200 200)
    (201 201) (202 202) (203 203) (204 204) (205 205) (206 206) (207 207)
    (208 272) (209 323) (210 210) (211 211) (212 212) (213 336) (214 214)
    (215 346) (216 368) (217 217) (218 218) (219 219) (220 220) (221 280)
    (222 538) (223 223) (224 224) (225 225) (226 226) (227 259) (228 228)
    (229 263) (230 230) (231 231) (232 232) (233 233) (234 234) (235 235)
    (236 236) (237 237) (238 238) (239 239) (240 273) (241 324) (242 242)
    (243 243) (244 244) (245 337) (246 246) (247 347) (248 369) (249 249)
    (250 250) (251 251) (252 252) (253 281) (254 539) (255 255)))
(defvar hyperlatex-inputenc-encoding-dec-mcs
  '((161 161) (162 162) (163 163) (165 165) (167 167) (168 164) (169 169)
    (170 170) (171 171) (176 176) (177 177) (178 178) (179 179) (181 181)
    (182 182) (183 183) (185 185) (186 186) (187 187) (188 188) (189 189)
    (191 191) (192 192) (193 193) (194 194) (195 195) (196 196) (197 197)
    (198 198) (199 199) (200 200) (201 201) (202 202) (203 203) (204 204)
    (205 205) (206 206) (207 207) (209 209) (210 210) (211 211) (212 212)
    (213 213) (214 214) (215 338) (216 216) (217 217) (218 218) (219 219)
    (220 220) (221 376) (223 223) (224 224) (225 225) (226 226) (227 227)
    (228 228) (229 229) (230 230) (231 231) (232 232) (233 233) (234 234)
    (235 235) (236 236) (237 237) (238 238) (239 239) (241 241) (242 242)
    (243 243) (244 244) (245 245) (246 246) (247 339) (248 248) (249 249)
    (250 250) (251 251) (252 252) (253 255)))
(defvar hyperlatex-inputenc-encoding-ibm850
  '((128 199) (129 252) (130 233) (131 226) (132 228) (133 224) (134 229)
    (135 231) (136 234) (137 235) (138 232) (139 239) (140 238) (141 236)
    (142 196) (143 197) (144 201) (145 230) (146 198) (147 244) (148 246)
    (149 242) (150 251) (151 249) (152 255) (153 214) (154 220) (155 248)
    (156 163) (157 216) (158 215) (159 402) (160 225) (161 237) (162 243)
    (163 250) (164 241) (165 209) (166 170) (167 186) (168 191) (169 174)
    (170 172) (171 189) (172 188) (173 161) (174 171) (175 187) (176 9617)
    (177 9618) (178 9619) (179 9474) (180 9508) (181 193) (182 194)
    (183 192) (184 169) (185 9571) (186 9553) (187 9559) (188 9565)
    (189 162) (190 165) (191 9488) (192 9492) (193 9524) (194 9516)
    (195 9500) (196 9472) (197 9532) (198 227) (199 195) (200 9562)
    (201 9556) (202 9577) (203 9574) (204 9568) (205 9552) (206 9580)
    (207 164) (208 240) (209 208) (210 202) (211 203) (212 200) (213 305)
    (214 205) (215 206) (216 207) (217 9496) (218 9484) (219 9608)
    (220 9604) (221 166) (222 204) (223 9600) (224 211) (225 223)
    (226 212) (227 210) (228 245) (229 213) (230 181) (231 254) (232 222)
    (233 218) (234 219) (235 217) (236 253) (237 221) (238 175) (239 180)
    (240 173) (241 177) (242 8215) (243 190) (244 182) (245 167) (246 247)
    (247 184) (248 176) (249 168) (250 183) (251 185) (252 179) (253 178)
    (254 9632) (255 160)))
(defvar hyperlatex-inputenc-encoding-ibm852
  '((128 199) (129 252) (130 233) (131 226) (132 228) (133 367) (134 263)
    (135 231) (136 322) (137 235) (138 336) (139 337) (140 238) (141 377)
    (142 196) (143 262) (144 201) (145 313) (146 314) (147 244) (148 246)
    (149 317) (150 318) (151 346) (152 347) (153 214) (154 220) (155 356)
    (156 357) (157 321) (158 215) (159 269) (160 225) (161 237) (162 243)
    (163 250) (164 260) (165 261) (166 381) (167 382) (168 280) (169 281)
    (170 172) (171 378) (172 268) (173 351) (174 171) (175 187) (176 9617)
    (177 9618) (178 9619) (179 9474) (180 9508) (181 193) (182 194)
    (183 282) (184 350) (185 9571) (186 9553) (187 9559) (188 9565)
    (189 379) (190 380) (191 9488) (192 9492) (193 9524) (194 9516)
    (195 9500) (196 9472) (197 9532) (198 258) (199 259) (200 9562)
    (201 9556) (202 9577) (203 9574) (204 9568) (205 9552) (206 9580)
    (207 164) (208 273) (209 272) (210 270) (211 203) (212 271) (213 327)
    (214 205) (215 206) (216 283) (217 9496) (218 9484) (219 9608)
    (220 9604) (221 354) (222 366) (223 9600) (224 211) (225 223)
    (226 212) (227 323) (228 324) (229 328) (230 352) (231 353) (232 340)
    (233 218) (234 341) (235 368) (236 253) (237 221) (238 355) (239 180)
    (240 173) (241 733) (242 731) (243 711) (244 728) (245 167) (246 247)
    (247 184) (248 176) (249 168) (250 729) (251 369) (252 344) (253 345)
    (254 9632) (255 160)))
(defvar hyperlatex-inputenc-encoding-ibm437
  '((128 199) (129 252) (130 233) (131 226) (132 228) (133 224) (134 229)
    (135 231) (136 234) (137 235) (138 232) (139 239) (140 238) (141 236)
    (142 196) (143 197) (144 201) (145 230) (146 198) (147 244) (148 246)
    (149 242) (150 251) (151 249) (152 255) (153 214) (154 220) (155 162)
    (156 163) (157 165) (158 8359) (159 402) (160 225) (161 237) (162 243)
    (163 250) (164 241) (165 209) (166 170) (167 186) (168 191) (169 8976)
    (170 172) (171 189) (172 188) (173 161) (174 171) (175 187) (176 9617)
    (177 9618) (178 9619) (179 9474) (180 9508) (181 9569) (182 9570)
    (183 9558) (184 9557) (185 9571) (186 9553) (187 9559) (188 9565)
    (189 9564) (190 9563) (191 9488) (192 9492) (193 9524) (194 9516)
    (195 9500) (196 9472) (197 9532) (198 9566) (199 9567) (200 9562)
    (201 9556) (202 9577) (203 9574) (204 9568) (205 9552) (206 9580)
    (207 9575) (208 9576) (209 9572) (210 9573) (211 9561) (212 9560)
    (213 9554) (214 9555) (215 9579) (216 9578) (217 9496) (218 9484)
    (219 9608) (220 9604) (221 9612) (222 9616) (223 9600) (224 945)
    (225 946) (226 915) (227 960) (228 931) (229 963) (230 181) (231 964)
    (232 934) (233 920) (234 937) (235 948) (236 8734) (237 966) (238 949)
    (239 8745) (240 8801) (241 177) (242 8805) (243 8804) (244 8992)
    (245 8993) (246 247) (247 8776) (248 176) (249 8729) (250 183)
    (251 8730) (252 8319) (253 178) (254 9632) (255 160)))
(defvar hyperlatex-inputenc-encoding-ibm437de
  '((128 199) (129 252) (130 233) (131 226) (132 228) (133 224) (134 229)
    (135 231) (136 234) (137 235) (138 232) (139 239) (140 238) (141 236)
    (142 196) (143 197) (144 201) (145 230) (146 198) (147 244) (148 246)
    (149 242) (150 251) (151 249) (152 255) (153 214) (154 220) (155 162)
    (156 163) (157 165) (158 8359) (159 402) (160 225) (161 237) (162 243)
    (163 250) (164 241) (165 209) (166 170) (167 186) (168 191) (169 8976)
    (170 172) (171 189) (172 188) (173 161) (174 171) (175 187) (176 9617)
    (177 9618) (178 9619) (179 9474) (180 9508) (181 9569) (182 9570)
    (183 9558) (184 9557) (185 9571) (186 9553) (187 9559) (188 9565)
    (189 9564) (190 9563) (191 9488) (192 9492) (193 9524) (194 9516)
    (195 9500) (196 9472) (197 9532) (198 9566) (199 9567) (200 9562)
    (201 9556) (202 9577) (203 9574) (204 9568) (205 9552) (206 9580)
    (207 9575) (208 9576) (209 9572) (210 9573) (211 9561) (212 9560)
    (213 9554) (214 9555) (215 9579) (216 9578) (217 9496) (218 9484)
    (219 9608) (220 9604) (221 9612) (222 9616) (223 9600) (224 945)
    (225 223) (226 915) (227 960) (228 931) (229 963) (230 181) (231 964)
    (232 934) (233 920) (234 937) (235 948) (236 8734) (237 966) (238 949)
    (239 8745) (240 8801) (241 177) (242 8805) (243 8804) (244 8992)
    (245 8993) (246 247) (247 8776) (248 176) (249 8729) (250 183)
    (251 8730) (252 8319) (253 178) (254 9632) (255 160)))
(defvar hyperlatex-inputenc-encoding-ibm865
  '((128 199) (129 252) (130 233) (131 226) (132 228) (133 224) (134 229)
    (135 231) (136 234) (137 235) (138 232) (139 239) (140 238) (141 236)
    (142 196) (143 197) (144 201) (145 230) (146 198) (147 244) (148 246)
    (149 242) (150 251) (151 249) (152 255) (153 214) (154 220) (155 248)
    (156 163) (157 216) (158 8359) (159 402) (160 225) (161 237) (162 243)
    (163 250) (164 241) (165 209) (166 170) (167 186) (168 191) (169 8976)
    (170 172) (171 189) (172 188) (173 161) (174 171) (175 164) (176 9617)
    (177 9618) (178 9619) (179 9474) (180 9508) (181 9569) (182 9570)
    (183 9558) (184 9557) (185 9571) (186 9553) (187 9559) (188 9565)
    (189 9564) (190 9563) (191 9488) (192 9492) (193 9524) (194 9516)
    (195 9500) (196 9472) (197 9532) (198 9566) (199 9567) (200 9562)
    (201 9556) (202 9577) (203 9574) (204 9568) (205 9552) (206 9580)
    (207 9575) (208 9576) (209 9572) (210 9573) (211 9561) (212 9560)
    (213 9554) (214 9555) (215 9579) (216 9578) (217 9496) (218 9484)
    (219 9608) (220 9604) (221 9612) (222 9616) (223 9600) (224 945)
    (225 223) (226 915) (227 960) (228 931) (229 963) (230 181) (231 964)
    (232 934) (233 920) (234 937) (235 948) (236 8734) (237 966) (238 949)
    (239 8745) (240 8801) (241 177) (242 8805) (243 8804) (244 8992)
    (245 8993) (246 247) (247 8776) (248 176) (249 8729) (250 183)
    (251 8730) (252 8319) (253 178) (254 9632) (255 160)))
(defvar hyperlatex-inputenc-encoding-macintosh
  '((128 196) (129 197) (130 199) (131 201) (132 209) (133 214) (134 220)
    (135 225) (136 224) (137 226) (138 228) (139 227) (140 229) (141 231)
    (142 233) (143 232) (144 234) (145 235) (146 237) (147 236) (148 238)
    (149 239) (150 241) (151 243) (152 242) (153 244) (154 246) (155 245)
    (156 250) (157 249) (158 251) (159 252) (160 8224) (161 176) (162 162)
    (163 163) (164 167) (165 8226) (166 182) (167 223) (168 174) (169 169)
    (170 8482) (171 180) (172 168) (173 8800) (174 198) (175 216)
    (176 8734) (177 177) (178 8804) (179 8805) (180 165) (181 181)
    (182 8706) (183 8721) (184 8719) (185 960) (186 8747) (187 170)
    (188 186) (189 937) (190 230) (191 248) (192 191) (193 161) (194 172)
    (195 8730) (196 402) (197 8776) (198 916) (199 171) (200 187)
    (201 8230) (202 160) (203 192) (204 195) (205 8486) (206 338)
    (207 339) (208 8211) (209 8212) (210 8220) (211 8221) (212 8216)
    (213 8217) (214 247) (215 9674) (216 255) (217 376) (218 8260)
    (219 164) (220 8249) (221 8250) (222 64257) (223 64258) (224 8225)
    (225 183) (226 8218) (227 8222) (228 8240) (229 194) (230 202)
    (231 193) (232 203) (233 200) (234 205) (235 206) (236 207) (237 204)
    (238 211) (239 212) (240 57374) (241 210) (242 218) (243 219)
    (244 217) (245 305) (248 175) (249 728) (250 729) (251 730) (252 184)
    (253 733) (254 731) (255 711)))
(defvar hyperlatex-inputenc-encoding-nextstep
  '((128 160) (129 192) (130 193) (131 194) (132 195) (133 196) (134 197)
    (135 199) (136 200) (137 201) (138 202) (139 203) (140 204) (141 205)
    (142 206) (143 207) (144 208) (145 209) (146 210) (147 211) (148 212)
    (149 213) (150 214) (151 217) (152 218) (153 219) (154 220) (155 221)
    (156 222) (157 181) (158 215) (159 247) (160 169) (161 161) (162 162)
    (163 163) (164 8260) (165 165) (166 402) (167 167) (168 164)
    (169 8217) (170 8220) (171 171) (172 8249) (173 8250) (174 64257)
    (175 64258) (176 174) (177 8211) (178 8224) (179 8225) (180 183)
    (181 166) (182 182) (183 8226) (184 8218) (185 8222) (186 8221)
    (187 187) (188 8230) (189 8240) (190 172) (191 191) (192 185)
    (193 715) (194 180) (195 710) (196 732) (197 175) (198 728) (199 729)
    (200 168) (201 178) (202 730) (203 184) (204 179) (205 733) (206 731)
    (207 711) (208 8212) (209 177) (210 188) (211 189) (212 190) (213 224)
    (214 225) (215 226) (216 227) (217 228) (218 229) (219 231) (220 232)
    (221 233) (222 234) (223 235) (224 236) (225 198) (226 237) (227 170)
    (228 238) (229 239) (230 240) (231 241) (232 321) (233 216) (234 338)
    (235 186) (236 242) (237 243) (238 244) (239 245) (240 246) (241 230)
    (242 249) (243 250) (244 251) (245 305) (246 252) (247 253) (248 322)
    (249 248) (250 339) (251 223) (252 254) (253 255)))
(defvar hyperlatex-inputenc-encoding-cp1252
  '((128 8364) (130 8218) (131 402) (132 8222) (133 8230) (134 8224)
    (135 8225) (136 710) (137 8240) (138 352) (139 8249) (140 338)
    (142 381) (145 8216) (146 8217) (147 8220) (148 8221) (149 8226)
    (150 8211) (151 8212) (152 732) (153 8482) (154 353) (155 8250)
    (156 339) (158 382) (159 376) (160 160) (161 161) (162 162) (163 163)
    (164 164) (165 165) (166 166) (167 167) (168 168) (169 169) (170 170)
    (171 171) (172 172) (173 173) (174 174) (175 175) (176 176) (177 177)
    (178 178) (179 179) (180 180) (181 181) (182 182) (183 183) (184 184)
    (185 185) (186 186) (187 187) (188 188) (189 189) (190 190) (191 191)
    (192 192) (193 193) (194 194) (195 195) (196 196) (197 197) (198 198)
    (199 199) (200 200) (201 201) (202 202) (203 203) (204 204) (205 205)
    (206 206) (207 207) (208 208) (209 209) (210 210) (211 211) (212 212)
    (213 213) (214 214) (215 215) (216 216) (217 217) (218 218) (219 219)
    (220 220) (221 221) (222 222) (223 223) (224 224) (225 225) (226 226)
    (227 227) (228 228) (229 229) (230 230) (231 231) (232 232) (233 233)
    (234 234) (235 235) (236 236) (237 237) (238 238) (239 239) (240 240)
    (241 241) (242 242) (243 243) (244 244) (245 245) (246 246) (247 247)
    (248 248) (249 249) (250 250) (251 251) (252 252) (253 253) (254 254)
    (255 255)))
(defvar hyperlatex-inputenc-encoding-cp1250
  '((128 8364) (130 8218) (132 8222) (133 8230) (134 8224) (135 8225)
    (137 8240) (138 352) (139 8249) (140 346) (141 356) (142 381)
    (143 377) (145 8216) (146 8217) (147 8220) (148 8221) (149 8226)
    (150 8211) (151 8212) (153 8482) (154 353) (155 8250) (156 347)
    (157 357) (158 382) (159 378) (160 160) (161 711) (162 728) (163 321)
    (164 164) (165 260) (166 166) (167 167) (168 168) (169 169) (170 350)
    (171 171) (172 172) (173 173) (174 174) (175 379) (176 176) (177 177)
    (178 731) (179 322) (180 180) (181 181) (182 182) (183 183) (184 184)
    (185 261) (186 351) (187 187) (188 317) (189 733) (190 318) (191 380)
    (192 340) (193 193) (194 194) (195 258) (196 196) (197 313) (198 262)
    (199 199) (200 268) (201 201) (202 280) (203 203) (204 282) (205 205)
    (206 206) (207 270) (208 272) (209 323) (210 327) (211 211) (212 212)
    (213 336) (214 214) (215 215) (216 344) (217 366) (218 218) (219 368)
    (220 220) (221 221) (222 354) (223 223) (224 341) (225 225) (226 226)
    (227 259) (228 228) (229 314) (230 263) (231 231) (232 269) (233 233)
    (234 281) (235 235) (236 283) (237 237) (238 238) (239 271) (240 273)
    (241 324) (242 328) (243 243) (244 244) (245 337) (246 246) (247 247)
    (248 345) (249 367) (250 250) (251 369) (252 252) (253 253) (254 355)
    (255 729)))

(defvar hyperlatex-inputenc-encodings-alist
  (list
   (list "ascii"    nil)
   (list "latin1"   hyperlatex-inputenc-encoding-iso-8859-1)
   (list "latin2"   hyperlatex-inputenc-encoding-iso-8859-2)
   (list "latin3"   hyperlatex-inputenc-encoding-iso-8859-3)
   (list "latin4"   hyperlatex-inputenc-encoding-iso-8859-4)
   (list "latin5"   hyperlatex-inputenc-encoding-iso-8859-9)
   (list "latin6"   hyperlatex-inputenc-encoding-iso-8859-10)
   (list "latin7"   hyperlatex-inputenc-encoding-iso-8859-13)
   (list "latin8"   hyperlatex-inputenc-encoding-iso-8859-14)
   (list "latin9"   hyperlatex-inputenc-encoding-iso-8859-15)
   (list "latin10"  hyperlatex-inputenc-encoding-iso-8859-16)
   (list "decmulti" hyperlatex-inputenc-encoding-dec-mcs)
   (list "cp850"    hyperlatex-inputenc-encoding-ibm850)
   (list "cp852"    hyperlatex-inputenc-encoding-ibm852)
   (list "cp437"    hyperlatex-inputenc-encoding-ibm437)
   (list "cp437de"  hyperlatex-inputenc-encoding-ibm437de)
   (list "cp865"    hyperlatex-inputenc-encoding-ibm865)
   (list "applemac" hyperlatex-inputenc-encoding-macintosh)
   (list "next"     hyperlatex-inputenc-encoding-nextstep)
   (list "ansinew"  hyperlatex-inputenc-encoding-cp1252)
   (list "cp1252"   hyperlatex-inputenc-encoding-cp1252)
   (list "cp1250"   hyperlatex-inputenc-encoding-cp1250)))

(defvar hyperlatex-inputenc-entities
  '(
    ;;(34 "quot")			; not in HTML 3.2 DTD (!)
    (38 "amp") (60 "lt") (62 "gt")
    (160 "nbsp") (161 "iexcl") (162 "cent") (163 "pound")
    (164 "curren") (165 "yen") (166 "brvbar") (167 "sect")
    (168 "uml") (169 "copy") (170 "ordf") (171 "laquo")
    (172 "not") (173 "shy") (174 "reg") (175 "macr")
    (176 "deg") (177 "plusmn") (178 "sup2") (179 "sup3")
    (180 "acute") (181 "micro") (182 "para") (183 "middot")
    (184 "cedil") (185 "sup1") (186 "ordm") (187 "raquo")
    (188 "frac14") (189 "frac12") (190 "frac34") (191 "iquest")
    (192 "Agrave") (193 "Aacute") (194 "Acirc") (195 "Atilde")
    (196 "Auml") (197 "Aring") (198 "AElig") (199 "Ccedil")
    (200 "Egrave") (201 "Eacute") (202 "Ecirc") (203 "Euml")
    (204 "Igrave") (205 "Iacute") (206 "Icirc") (207 "Iuml")
    (208 "ETH") (209 "Ntilde") (210 "Ograve") (211 "Oacute")
    (212 "Ocirc") (213 "Otilde") (214 "Ouml") (215 "times")
    (216 "Oslash") (217 "Ugrave") (218 "Uacute") (219 "Ucirc")
    (220 "Uuml") (221 "Yacute") (222 "THORN") (223 "szlig")
    (224 "agrave") (225 "aacute") (226 "acirc") (227 "atilde")
    (228 "auml") (229 "aring") (230 "aelig") (231 "ccedil")
    (232 "egrave") (233 "eacute") (234 "ecirc") (235 "euml")
    (236 "igrave") (237 "iacute") (238 "icirc") (239 "iuml")
    (240 "eth") (241 "ntilde") (242 "ograve") (243 "oacute")
    (244 "ocirc") (245 "otilde") (246 "ouml") (247 "divide")
    (248 "oslash") (249 "ugrave") (250 "uacute") (251 "ucirc")
    (252 "uuml") (253 "yacute") (254 "thorn") (255 "yuml")
    ;; not HTML 3.2 and not supported by all browsers
    ;;(338 "OElig") (339 "oelig") (352 "Scaron") (353 "scaron")
    ;;(376 "Yuml") (8364 "euro")
    ))

(setq hyperlatex-inputenc-alist
      (mapcar
       (function
	(lambda (e)
	  (let ((a (assq (nth 1 e) hyperlatex-inputenc-entities)))
	    (list (car e) (nth 1 e)
		  (if a (format "&%s;" (nth 1 a))
		    (format "&#%d;" (nth 1 e)))))))
       (nth 1 (assoc (car hyperlatex-options)
		     hyperlatex-inputenc-encodings-alist))))

(hyperlatex-message "  Encoding \"%s\" %s" (car hyperlatex-options)
		    (if hyperlatex-inputenc-alist "found" "not found"))

(setq hyperlatex-inputenc-regexp
      (concat "[" (mapcar 'car hyperlatex-inputenc-alist) "]"))

;; Syntax table: disallow any additional parenthesis chars
;; (e.g. French guillemets)
(mapcar (function (lambda (e)
		    (and (memq (char-syntax (car e)) '(?\( ?\)))
			 (modify-syntax-entry
			  (car e) "_" hyperlatex-format-syntax-table))))
	hyperlatex-inputenc-alist)

(defun hyperlatex-inputenc-char-to-utf8 (c)
  (if (< c 128) (char-to-string c)
    (let ((m 64) (s ""))
      (while (>= c m)
	(setq s (concat (char-to-string (+ 128 (logand c 63))) s))
	(setq c (lsh c -6))
	(setq m (lsh m -1)))
      (concat (char-to-string (+ (- 256 m m) c)) s))))

;; examples from ISO 10646-1:2000 Annex D
;;(mapcar '(lambda (s) (mapconcat '(lambda (i) (format "%02x" i))
;;				(hyperlatex-inputenc-char-to-utf8 s) ""))
;;	'(1 127 128 2047 2048 65535 65536 1114111
;;	    2097151 2097152 67108863 67108864))
;;("01" "7f" "c280" "dfbf" "e0a080" "efbfbf" "f0908080" "f48fbfbf"
;; "f7bfbfbf" "f888808080" "fbbfbfbfbf" "fc8480808080")

(defun hyperlatex-inputenc-get-metacharset ()
  (let ((expansion
	 (nth 2 (assoc "HlxMetaCharset" hyperlatex-new-commands))))
    (and expansion
	 (string-match "charset=\\([^\"]+\\)" expansion)
	 (downcase (match-string 1 expansion)))))

(defun hyperlatex-inputenc-substitute ()
  (let ((outenc (or hyperlatex-inputenc-output-encoding
		    (nth 1 (assoc (hyperlatex-inputenc-get-metacharset)
				  '(("iso-8859-1" iso-8859-1)
				    ("utf-8" utf-8))))))
	(case-fold-search nil))
    (save-excursion
      (goto-char (point-min))
      (or (equal hyperlatex-inputenc-regexp "[]")
	  (while (re-search-forward hyperlatex-inputenc-regexp nil t)
	    (let* ((c (logand (preceding-char) 255))
		   (a (assq c hyperlatex-inputenc-alist))
		   (n (nth 1 a)))
	      (replace-match
	       (cond ((null a) "?")	; should never happen
		     ((and (eq outenc 'iso-8859-1) (< n 256))
		      (char-to-string n))
		     ((eq outenc 'utf-8)
		      (hyperlatex-inputenc-char-to-utf8 n))
		     ((eq outenc 'numeric) (format "&#%d;" n))
		     (t (nth 2 a)))	; default: mnemonic entity
	       t t)))))))

(defadvice hyperlatex-final-substitutions
  (after hyperlatex-inputenc-final-substitutions activate)
  (hyperlatex-inputenc-substitute))
}
